<div class="d-flex justify-content-between m-3">
  <span class="h5">Ψηφιοποίηση του Κώδικα των ΟΤΑ</span>
  <button type="button" class="btn-close" (click)="modalRef.dismiss()">
  </button>
</div>

<div class="modal-body">
  <div class="mb-3 mt-3 p-2">
    <form [formGroup]="form" class="container mt-4">

      @if (legalProvisions.length || instructionProvisions.length) {
        <div class="mb-3">
          <label class="form-label">
            Περιεχόμενο αρμοδιότητας:
            @if (showInfoText) {
              <div class="mt-2" [innerHTML]="sanitizeHtml(showInfoText)"></div>
            }
          </label>
          <div class="NgxEditor__Wrapper">
              <ngx-editor-menu [editor]="editor" [toolbar]="toolbar"></ngx-editor-menu>
              <ngx-editor [editor]="editor" formControlName="remitText"></ngx-editor>
            </div>
            @if (form.controls.remitText.touched && form.controls.remitText.invalid) {
            <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
            }
        </div>
      }

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Φορέας άσκησης αρμοδιότητας:</label>
          <select formControlName="remitCompetence" class="form-select">
            <option value="" disabled>-- Επιλογή --</option>
            @for (name of remitCompetences; track name) {
              <option [value]="name">{{ name }}</option>
            }
          </select>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">Τύπος αρμοδιότητας:</label>
          <select formControlName="remitType" class="form-select">
            <option value="" disabled>-- Επιλογή --</option>
            @for (name of remitTypes; track name) {
              <option [value]="name">{{ name }}</option>
            }
          </select>
        </div>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label" for="remitLocalOrGlobal">Αυτοδιοικητική Αρμοδιότητα:</label>
        <select formControlName="remitLocalOrGlobal" id="remitLocalOrGlobal" class="form-select">
          <option value="" disabled>-- Επιλογή --</option>
          <option value="Αυτοδιοικητική Αρμοδιότητα (Τοπική)">Αυτοδιοικητική Αρμοδιότητα (Τοπική)</option>
          <option value="Αρμοδιότητα που συνιστά αποστολή του κράτους (Κρατική)">Αρμοδιότητα που συνιστά αποστολή του κράτους (Κρατική)</option>
        </select>
      </div>

      <div class="mb-3">
        <div class="mb-3 d-flex flex-column">
          <label class="form-label d-flex justify-content-between">
            <span>
              @if (legalProvisions.length === 1) {
              Διάταξη
              } @else {
              Διατάξεις
              }
              Πρόβλεψης Κώδικα:
            </span>

            <button type="button" class="btn btn-primary btn-sm" [disabled]="!canAddLegalProvision"
              (click)="newLegalProvision()">
              Προσθήκη Διάταξης
            </button>
          </label>
          <app-list-legal-provisions [legalProvisions]="legalProvisions" [code]=""
            [remitID]="ota?._id" [provisionType]="'ota'" [actionColumnVisible]="ota !== null">
          </app-list-legal-provisions>
        </div>
      </div>

      <div class="mb-3">
        <div class="mb-3 d-flex flex-column">
          <label class="form-label d-flex justify-content-between">
            <span>
              @if (legalProvisions.length === 1) {
              Εγκύκλια
              } @else {
              Εγκύκλιες
              }
              Οδηγίες:
            </span>

            <button type="button" class="btn btn-primary btn-sm" [disabled]="!canAddLegalProvision"
              (click)="newInstructionProvision()">
              Προσθήκη Εγκύκλιας Οδηγίας
            </button>
          </label>
          <app-list-legal-provisions [legalProvisions]="instructionProvisions" [code]=""
            [remitID]="ota?._id" [provisionType]="'ota_instructions'" [actionColumnVisible]="ota !== null">
          </app-list-legal-provisions>
        </div>
      </div>
      
      <div class="mb-3">
        <label class="form-label d-flex justify-content-between">Πίνακας Επιλογής Φορέα και Μονάδας Δημόσιας Πολιτικής</label>

        <ul>
          @for (unit of gridSelectedData; track unit ){
            <li><strong>Φορέας Δημόσιας Πολιτικής: </strong>{{unit.organization}}, <strong>Μονάδα Δημόσιας Πολιτικής: </strong>{{unit.preferredLabel}}</li>
          }
        </ul>

        <div class="d-flex justify-content-between small">
          <div>
            <span>Eπιλέξτε τους φορείς/μονάδες που επιθυμείτε</span>
          </div>
          <div>
            <a (click)="clearSelection()" class="btn btn-danger btn-sm mb-1" role="button">Καθάρισμα επιλογών</a>
          </div>
        </div>

        <ag-grid-angular
          [domLayout]="'autoHeight'"
          [rowData]="monades"
          [defaultColDef]="defaultColDef"
          [columnDefs]="colDefs"
          [pagination]="true"
          [paginationPageSize]="10"
          [loadingOverlayComponent]="loadingOverlayComponent"
          [loadingOverlayComponentParams]="loadingOverlayComponentParams"
          rowSelection="multiple"
          (rowSelected)="onRowSelected($event)"
          (gridReady)="onGridReady($event)"
          class="ag-theme-balham">
        </ag-grid-angular>
      </div>

      <div class="d-flex gap-2">
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="!form.valid"
          (click)="onCreate()"
          >Υποβολή</button>
        <button type="button" class="btn btn-secondary" (click)="resetForm()">Καθάρισμα</button>
      </div>
    </form>
  </div>
</div>

<div class="d-flex justify-content-end m-3">
  <button ngbAutofocus type="button" class="btn btn-primary" (click)="modalRef.close()">
    Επιστροφή
  </button>
</div>